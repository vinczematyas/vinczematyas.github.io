---
import GlobalHead from '@components/GlobalHead.astro';
import Header from '@components/Header.astro';
import Footer from '@components/Footer.astro';
import '@styles/global.css';
---

<html lang='en'>
  <head>
    <script is:inline>
      (() => {
        const root = document.documentElement;
        const storageKey = "preferred-color-scheme";
        const prefersLight = window.matchMedia ? window.matchMedia("(prefers-color-scheme: light)") : null;

        const applyTheme = (theme) => {
          const isLight = theme === "light";
          root.classList.toggle("theme-light", isLight);
          root.classList.toggle("theme-dark", !isLight);
          root.style.colorScheme = isLight ? "light" : "dark";
        };

        const getStoredTheme = () => {
          try {
            return localStorage.getItem(storageKey);
          } catch {
            return null;
          }
        };

        const storedTheme = getStoredTheme();
        if (storedTheme === "light" || storedTheme === "dark") {
          applyTheme(storedTheme);
        } else {
          applyTheme(prefersLight && prefersLight.matches ? "light" : "dark");
        }

        prefersLight?.addEventListener?.("change", (event) => {
          if (getStoredTheme()) return;
          applyTheme(event.matches ? "light" : "dark");
        });
      })();
    </script>
    <GlobalHead />
  </head>
  <body class='flex flex-col min-h-screen'>
    <Header />
    <main class='flex-grow'>
      <slot />
    </main>
    <Footer />
  </body>
</html>

